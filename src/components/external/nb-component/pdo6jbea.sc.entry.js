const t=window.NbComponent.h;let e={};class s{constructor(){this.noMore=!1,this.dampHeight=30,this.positionSaveId=null,this.dampingLen=0,this.loading=!1,this.handleTouchStart=(t=>{this.startPageY=t.touches[0].pageY}),this.handleTouchMove=(t=>{this.movePageY=t.touches[0].pageY,this.noMore||this.loading||(this.recordStartDampLen(),this.startDampLen>0&&"refresh"!==this.disable&&(this.pullLength>this.startDampLen?(this.dampingLen=this.pullLength-this.startDampLen,this.dampingLen>this.dampHeight&&(this.dampingLen=this.dampHeight)):this.pullLength+3<this.startDampLen&&(this.dampingLen=0)),this.startDampLen<0&&"more"!==this.disable&&(this.pullLength<this.startDampLen?(this.dampingLen=this.pullLength+this.startDampLen,this.dampingLen<-this.dampHeight&&(this.dampingLen=-this.dampHeight)):this.pullLength-3>this.startDampLen&&(this.dampingLen=0)),0!==this.startDampLen&&(this.$content.style.webkitTransition="transform 0.3s",this.$content.style.webkitTransform=`translateY(${this.dampingLen}px)`))}),this.handleTouchEnd=(()=>{this.startDampLen=null,this.noMore||(console.log(this.dampingLen),Math.abs(this.dampingLen)>3&&(this.loading=!0),this.dampingLen>3&&"refresh"!==this.disable&&this.refresh.emit(),this.dampingLen<-3&&"more"!==this.disable&&this.more.emit(),this.positionSaveId&&(e[this.positionSaveId]=this.getScrollTop()))})}async done(){return this.$content.style.transform="translateY(0px)",this.dampingLen=0,this.loading=!1,!0}async restoreLastPosition(){return this.positionSaveId&&e[this.positionSaveId]&&(this.$wrapper.scrollTop=e[this.positionSaveId]),e[this.positionSaveId]||0}get pullLength(){return this.movePageY-this.startPageY}getScrollTop(){return this.$wrapper.scrollTop}getWrapperScrollTop(){return this.$wrapper.scrollHeight-this.$wrapper.clientHeight}recordStartDampLen(){this.startDampLen||(0===this.getScrollTop()&&this.pullLength>0||Math.abs(this.getScrollTop()-this.getWrapperScrollTop())<2&&this.pullLength<0)&&(this.startDampLen=this.pullLength)}bindTouchScroll(t=!0){try{this.$wrapper=document.querySelector(this.wrapperSelector),this.$content=document.querySelector(this.contentSelector)}catch(t){throw console.log(t),new TypeError('"wrapperSelector" or "contentSelector" props maybe not a valid scroll dom selector.')}if(!this.$wrapper)return console.log("$wrapper undefined");t?(this.$wrapper.addEventListener("touchstart",this.handleTouchStart,!1),this.$wrapper.addEventListener("touchmove",this.handleTouchMove,!1),this.$wrapper.addEventListener("touchend",this.handleTouchEnd,!1)):(this.$wrapper.removeEventListener("touchstart",this.handleTouchStart,!1),this.$wrapper.removeEventListener("touchmove",this.handleTouchMove,!1),this.$wrapper.removeEventListener("touchend",this.handleTouchEnd,!1))}componentDidLoad(){this.bindTouchScroll(),this.positionSaveId&&e[this.positionSaveId]&&console.log("上次位置",e[this.positionSaveId])}componentDidUnload(){this.bindTouchScroll(!1)}render(){return t("div",{class:"pull-to-do"},t("div",{class:`${this.dampingLen>.8*this.dampHeight&&!this.noMore?"show":"hide"}`},t("div",{class:this.loading?"show":"hide"},t("slot",{name:"refresh-loading"})),t("div",{class:this.loading?"hide":"show"},t("slot",{name:"refresh"}))),t("slot",{name:"main"}),t("div",{class:`bottom ${this.noMore&&!this.loading?"show":"hide"}`},t("slot",{name:"no-more"})),t("div",{class:`bottom ${this.loading?"show":"hide"}`},t("slot",{name:"more-loading"})),t("div",{class:`bottom ${this.loading||this.noMore?"hide":"show"}`},t("slot",{name:"more"})))}static get is(){return"nb-pull-to-do"}static get encapsulation(){return"shadow"}static get properties(){return{contentSelector:{type:String,attr:"content-selector"},dampHeight:{type:Number,attr:"damp-height"},dampingLen:{state:!0},disable:{type:String,attr:"disable"},done:{method:!0},el:{elementRef:!0},loading:{type:Boolean,attr:"loading",mutable:!0},noMore:{type:Boolean,attr:"no-more"},positionSaveId:{type:String,attr:"position-save-id"},restoreLastPosition:{method:!0},wrapperSelector:{type:String,attr:"wrapper-selector"}}}static get events(){return[{name:"refresh",method:"refresh",bubbles:!0,cancelable:!0,composed:!0},{name:"more",method:"more",bubbles:!0,cancelable:!0,composed:!0}]}static get style(){return".pull-to-do.sc-nb-pull-to-do{position:relative;padding-bottom:.64rem}.pull-to-do.sc-nb-pull-to-do   .hide.sc-nb-pull-to-do, .pull-to-do.sc-nb-pull-to-do   .show.sc-nb-pull-to-do{position:absolute;width:100%;opacity:1;-webkit-transition:opacity .3s;transition:opacity .3s;min-height:.64rem;z-index:1}.pull-to-do.sc-nb-pull-to-do   .hide.sc-nb-pull-to-do{opacity:0;z-index:-1}.pull-to-do.sc-nb-pull-to-do   .bottom.sc-nb-pull-to-do{top:auto;bottom:0}"}}export{s as NbPullToDo};