const t=window.NbComponent.h,n="$_BUTTON_COUNTDOWN";class o{constructor(){this.width=690,this.height=88,this.bg="#3E86F7",this.color="#ffffff",this.radius=8,this.noBorder=!1,this.countdownId="",this.countdown=0,this.countdownContainer=".countdown",this.countdownOrigin=".origin",this.countdownReplace="%n",this.countdownHtml="倒计时%n秒",this.loading=!1,this.disable=!1,this.countdownDisplay=0}async done(){const t=this.el.querySelector(this.countdownContainer),o=this.el.querySelector(this.countdownOrigin);return this.disable=!1,this.loading=!1,this.countdownTimer=null,this.countdownDisplay=0,sessionStorage.removeItem(n+this.countdownId),this.count.emit({status:"finish"}),t&&(t.innerHTML=""),o&&(o.style.display="block"),!0}get btnStyles(){let t="1px solid transparent";return"#ffffff"===this.bg&&"#ffffff"!==this.color&&(t=`1px solid ${this.color}`),{width:`${this.width/75}rem`,height:`${this.height/75}rem`,borderRadius:`${this.radius/75}rem`,background:this.bg,color:this.color,border:this.noBorder?"none":t}}handleCountdown(){this.disable=!0;const t=this.el.querySelector(this.countdownContainer),o=this.el.querySelector(this.countdownOrigin);return t&&(t.innerHTML=this.countdownHtml.replace(this.countdownReplace,String(this.countdownDisplay))),o&&(o.style.display="none"),sessionStorage.setItem(n+this.countdownId,String(this.countdownDisplay)),this.countdownDisplay>0?(this.countdownDisplay--,this.countdownTimer=setTimeout(this.handleCountdown.bind(this),1e3)):(clearTimeout(this.countdownTimer),this.done()),!0}async handleClick(){return this.loading=!0,this.countdown>0&&(0==this.countdownDisplay&&(this.countdownDisplay=this.countdown,this.count.emit({status:"start"})),this.countdownTimer||this.handleCountdown()),this.tap.emit({done:this.done.bind(this)}),!0}componentWillLoad(){this.countdownDisplay=Number(sessionStorage.getItem(n+this.countdownId)||0)}componentDidLoad(){this.countdownDisplay>0&&this.countdown>0&&this.handleCountdown()}componentDidUnload(){clearTimeout(this.countdownTimer)}render(){return t("button",{onClick:this.handleClick.bind(this),disabled:this.disable||this.loading,class:`btn ${this.loading?"loading":""}`,style:Object.assign({},this.btnStyles)},t("slot",null))}static get is(){return"nb-button-async"}static get encapsulation(){return"shadow"}static get properties(){return{bg:{type:String,attr:"bg"},color:{type:String,attr:"color"},countdown:{type:Number,attr:"countdown"},countdownContainer:{type:String,attr:"countdown-container"},countdownDisplay:{state:!0},countdownHtml:{type:String,attr:"countdown-html"},countdownId:{type:String,attr:"countdown-id"},countdownOrigin:{type:String,attr:"countdown-origin"},countdownReplace:{type:String,attr:"countdown-replace"},disable:{type:Boolean,attr:"disable",mutable:!0},done:{method:!0},el:{elementRef:!0},handleClick:{method:!0},height:{type:Number,attr:"height"},loading:{type:Boolean,attr:"loading",mutable:!0},noBorder:{type:Boolean,attr:"no-border"},radius:{type:Number,attr:"radius"},width:{type:Number,attr:"width"}}}static get events(){return[{name:"tap",method:"tap",bubbles:!0,cancelable:!0,composed:!0},{name:"count",method:"count",bubbles:!0,cancelable:!0,composed:!0}]}static get style(){return".btn.sc-nb-button-async{border:none;outline:none}.btn.loading.sc-nb-button-async, .btn[disabled].sc-nb-button-async{opacity:.5}"}}export{o as NbButtonAsync};